<p><strong>Paciente:</strong> {{ medical_history.patient.first_name }} {{ medical_history.patient.last_name }}</p>
<p><strong>Médico:</strong> {{ medical_history.doctor.first_name }} {{ medical_history.doctor.last_name }}</p>
<p><strong>Fecha de Creación:</strong> {{ medical_history.created_at }}</p>
<p><strong>Diagnóstico:</strong> {{ medical_history.diagnosis }}</p>
<p><strong>Tratamiento:</strong> {{ medical_history.treatment }}</p>
<p><strong>Estado:</strong> {{ medical_history.get_status_display }}</p>
<p><strong>ID del diagnóstico:</strong> {{ medical_history.id }}</p>
<p><strong>ID de la Cita Asociada:</strong> {{ appointment_id }}</p>

<!-- Botón para descargar la receta en PDF -->
<button class="btn btn-success" id="downloadPrescriptionBtn" onclick="downloadPrescription('{{ medical_history.id }}')">
    <i class="fa-solid fa-file-arrow-down"></i> Descargar Receta
</button>

<script>
    // Añadir token CSRF a todas las peticiones HTMX
    document.addEventListener('htmx:configRequest', (event) => {
        const csrfToken = "{{ csrf_token }}";
        event.detail.headers['X-CSRFToken'] = csrfToken;
    });

    // Función para manejar la descarga de la receta en PDF
    function downloadPrescription(medicalHistoryId) {
        const url = `/core/medical-history/${medicalHistoryId}/download-prescription/`;
        window.location.href = url;
    }
</script>